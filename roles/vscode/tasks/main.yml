---
- name: Check if VS Code is already installed
  win_stat:
    path: "{{ app_exe_path }}"
  register: code_installed

- name: VS Code already installed â€” skipping
  debug:
    msg: "VS Code already installed"
  when: code_installed.stat.exists

- name: Ensure installer directory exists
  win_file:
    path: "{{ installer_folder }}"
    state: directory
  when: not code_installed.stat.exists

- name: Download VS Code installer from GitHub Release
  win_get_url:
    url: "{{ installer_url }}"
    dest: "{{ installer_dest }}"
    force: true
  when: not code_installed.stat.exists

- name: Install VS Code silently
  win_command: '"{{ installer_dest }}" /VERYSILENT /MERGETASKS=!runCode'
  when: not code_installed.stat.exists

- name: Installation successful
  debug:
    msg: "VS Code installed successfully!"
  when: not code_installed.stat.exists
