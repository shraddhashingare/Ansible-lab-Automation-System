# File path: roles/vscode/tasks/main.yml
---
- name: Check VS Code installed
  win_stat:
    path: "{{ exe_path }}"
  register: code_installed

- debug:
    msg: "VS Code already installed â€” skipping"
  when: code_installed.stat.exists

- name: Ensure installer directory exists
  win_file:
    path: "C:\\Ansible\\Installers"
    state: directory
  when: not code_installed.stat.exists

- name: Check installer exists
  win_stat:
    path: "{{ dest }}"
  register: vs_installer
  when: not code_installed.stat.exists

- name: Copy installer
  win_copy:
    src: "{{ src }}"
    dest: "{{ dest }}"
  when:
    - not code_installed.stat.exists
    - not vs_installer.stat.exists

- name: Install silently
  win_command: '"{{ dest }}" /VERYSILENT /MERGETASKS=!runCode'
  when: not code_installed.stat.exists